\section{Advecting a set of initial conditions}
\label{sec:advecting_a_set_of_initial_conditions}

The variational model is based upon the advection of non-interacting tracers,
cf. \cref{sec:typeofflow}, by the velocity field defined in equation
\eqref{eq:doublegyre}. The system has no known analytical solution for the
tracer trajectories. Thus, it must be solved numerically, by means of some
numerical integration method, e.g.\ a Runge-Kutta method, cf.\
\cref{sub:the_runge_kutta_family_of_numerical_methods}. With the main focus
of this project being the dependence on LCSs on the chosen integration method,
the advection was performed using all of the numerical integrators introduced
in \cref{sub:the_runge_kutta_methods_under_consideration}.

\subsection{Generating a set of initial conditions}
\label{sub:generating_a_set_of_initial_conditions}
The computational domain $\mathcal{U}=[0\hspace{1ex}2]\times[0\hspace{1ex}1]$
was discretized by a set of linearly spaced tracers, with $1000\times500$ grid
points, effectively creating a nearly uniform grid of approximate spacing
$\Delta{x}\simeq\Delta{y}\simeq0.002$. Tracers were placed on, and within, the
domain boundaries of $\mathcal{U}$. The grid was extended artificially,
with an additional two rows or columns appended to all of the domain edges,
with the same grid spacing as the \emph{main} grid. This was done in order to
ensure that the dynamics at the domain boundaries were included in the analysis
to follow. The extended grid thus had a total of $1004\times504$ grid points.
The construction of the grid is illustrated in figure~\ref{fig:initialgrid}.

\vfill{}

\input{mainmatter/method/figures/initialgridfigure.tex}

In order to increase the resolution of the Cauchy-Green strain tensor,
it is necessary to increase the accuracy with which one computes the
Jacobian of the flow map, cf.\ equation \eqref{eq:cauchygreen}. This was done
by advecting a set of auxiliary tracer points surrounding each main point. To
each tracer point $\vct{x}_{j}=(x_{j},y_{j})$, neighboring points defined as

\begin{equation}
    \label{eq:auxgrid}
    \begin{gathered}
        \vct{x}_{j}^{r} = (x_{j}+\delta{x},y_{j}),%
                \quad\vct{x}_{j}^{l} = (x_{j}-\delta{x},y_{j})\\
                \vct{x}_{j}^{u} = (x_{j},y_{j}+\delta{y}),%
                \quad\vct{x}_{j}^{l} = (x_{j},y_{j}-\delta{y})\\
\end{gathered}
\end{equation}

where $\delta{x}$ and $\delta{y}$ are increments smaller than the grid spacings
$\Delta{x}\simeq\Delta{y}$, were assigned. Even though this effectively means
that five times as many tracers have to be advected, the resulting accuracy in
computing the Jacobian of the flow map, by means of the auxiliary tracers, is
determined by the independent variables $\delta{x}$ and $\delta{y}$,
theoretically allowing for arbitrary precision. The concept of the auxiliary
tracers is illustrated in figure~\ref{fig:auxiliarygrid}.

\input{mainmatter/method/figures/auxiliarygridfigure.tex}

Because of the limited number of decimal digits which can be accuractely
represented by floating-point numbers, however, there is a strict lower limit
to which it makes sense to lower the values of $\delta{x}$ and $\delta{y}$. In
particular, the smallest number which can be resolved as a double-precision
floating-point number is of the order $10^{-16}$. When decreasing the
auxiliary grid spacing, the increase in precision is quickly offset by the fact
that one automatically gets allocated a smaller number of decimal digits with
which one calculate the discrete approximation of the derivatives involved
in the Jacobian. This is due to the double gyre velocity field, cf.\
equation~\eqref{eq:doublegyre}, being well-behaved, leading most tracers which
are initially close to follow very similar trajectories, often ending up
with a separation distance comparable to the initial offset. For this reason,
the auxiliary grid spacing $\delta{x}=\delta{y}=10^{-5}$ was chosen ---
three orders of magnitude smaller than the original grid spacing, ensuring that
the derivatives in the Jacobian are far more well-resolved than for the main
tracera, while also leaving approximately $10$ decimal digits for which there
can be a difference in the final positions of the auxiliary tracers.

\subsection{On the choice of numerical step lengths and tolerance levels}
\label{sub:on_the_choice_of_numerical_step_lengths_and_tolerance_levels}

For the fixed stepsize integrators, step lengths of $10^{-1}$ through to
$10^{-5}$ were used. The reason even smaller step lengths were not considered
is the following: For a step length of $10^{-5}$, the total number of
integration steps required in order to take the system from $t=0$ to $t=20$
is of order $10^{6}$. As previously mentioned, the inherent accuracy of
double-precision floating point numbers is of order $10^{-16}$. Thus, the
total floating point error expected to arise when integrating with a step
length of $10^{-5}$ is of order $10^{-10}$.

The least accurate of the fixed stepsize integrators integrators under
consideration, the Euler method, is \nth{1} order accurate globally, meaning
that its local error is of \nth{2} order, cf.\
\cref{def:rungekuttaorder}. Thus, we expect that the local error of the Euler
method, for a step length of $10^{-5}$, is of order $10^{-10}$, i.e., the
same order as the accumulated floating-point errors. Reducing the time step
further necessarily leads to an increase in the accumulated floating-point
errors, meaning that we cannot reasonably expect to resolve the positions
from one step to the next more accurately, for the Euler method. At the very
least, a time step of $10^{-5}$ appears to represent a point after which
there is little to be gained in terms of increased numerical accuracy for the
Euler method. For the other fixed stepsize integrators, which are of higher
order, we expect this breaking point to occur for a somewhat larger time step.

While the above logic does not translate directly for the adaptive stepsize
integrators, empirical tests indicate that for both of the Bogacki-Shampine
integrators, as well as for the Dormand-Prince 5(4) integrator, the accumulated
floating-point errors caught up to the required tolerance level at some point
between the levels $10^{-10}$ and $10^{-11}$, while the Dormand-Prince 8(7)
integrator held its ground until a tolerance level of about $10^{-13}$. For this
reason, tolerance levels of $10^{-1}$ through to $10^{-10}$ were used for the
adaptive stepsize integrators. Furthermore, as no analytical solution exists
for the double gyre system, cf.\ equation~\eqref{eq:doublegyre}, a numerical
solution was needed as the reference. Following the discussion above, the
solution obtained via the Dormand-Prince 8(7) integrator with a numerical
tolerance level of $10^{-12}$ was used as the benchmark.

With the addition of the aforementioned auxiliary tracers, the total number
of tracers which were advected became of order $2.5$ million. In order to
accelerate the computational process, the advection was parallellized by means
of MPI and ran on NTNU's supercomputer, Vilje. The associated speedup was
crucial for this project --- for example, advection using the Euler method
and a time step of $10^{-5}$ required in excess of $1000$ computational
walltime hours; an insurmountable feat for most computers, including the
author's own personal laptop.
